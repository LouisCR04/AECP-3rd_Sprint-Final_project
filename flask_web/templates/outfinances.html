{% extends "layout.html" %}
{% block content %}
    <h2>{{ church.name }}</h2>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
</head>
<body>
    <table id="financeTable" class="display">
        <thead>
            <tr>
                <th>FinanceType</th>
		<th>Amount</th>
		<th>Date</th>
                <!-- Add more table headers if needed -->
            </tr>
        </thead>
        <tbody>
            <!-- Table body will be populated dynamically -->
        </tbody>
    </table>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- DataTables JavaScript -->
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script>
    (function($) {
        document.addEventListener("DOMContentLoaded", function () {
            const churchId = "{{ church.id }}";  // Specify the church ID you want to fetch

            fetch(`http://localhost:5001/api/v1/churches/${churchId}/outfinances`)
                .then(response => response.json())
                .then(data => {
                    const outfinances = data;

                    // Populate table with counties data
                    const tableBody = document.querySelector('#financeTable tbody');
                    outfinances.forEach(outfinance => {  // Use a singular name for the loop variable
                        const row = tableBody.insertRow();
			const formattedDate = formatDate(outfinance.dated);
                        row.innerHTML = `
			    <td>${outfinance.finance_type}</td>
                            <td>${outfinance.amount}</td>
			    <td>${formattedDate}</td>
                            <!-- Add more cells if needed -->
                        `;
                    });

                    // Initialize DataTables after populating the table
                    $('#financeTable').DataTable();
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                });

             // Function to format date to dd mm yyyy
            function formatDate(dateString) {
                const dateObj = new Date(dateString);
                const day = dateObj.getDate().toString().padStart(2, '0');
                const month = (dateObj.getMonth() + 1).toString().padStart(2, '0'); // Adding 1 because January is 0
                const year = dateObj.getFullYear().toString();
                return `${day}/${month}/${year}`
	    }
        });
	})(jQuery); // Pass jQuery as argument
    </script>
</body>
</html>

{% endblock content%}
